#!/usr/bin/env sh
# POSIX safety
set -eu
if (set -o pipefail) 2>/dev/null; then
  set -o pipefail
fi
# nb: update personal notes repo (1st_level) and music list, auto-commit if changed
# Usage: nb [-h|--help]

if [ "${1:-}" = "-h" ] || [ "${1:-}" = "--help" ]; then
  printf "nb: update notes and push if changed\n" >&2
  exit 0
fi

git -C "$HOME/1st_level" pull
find "$HOME"/music -maxdepth 1 -type d | sort > "$HOME"/1st_level/notes/music/list
if [ "$(git -C "$HOME"/1st_level status --short -b | wc -l)" -ge 2 ]; then
    zk -W "$HOME"/1st_level index
    git -C "$HOME"/1st_level add . \
        && git -C "$HOME"/1st_level commit -am "update notes $(date '+%d-%m-%Y %H:%M:%S')" \
        && git -C "$HOME"/1st_level push
fi 
