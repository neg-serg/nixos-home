#!/usr/bin/env bash
set -euo pipefail

root="$(git rev-parse --show-toplevel)"
cd "$root"

# Rebuild Theme.json from split parts before running validators
node quickshell/.config/quickshell/Tools/build-theme.mjs \
  --dir quickshell/.config/quickshell/Theme \
  --out quickshell/.config/quickshell/Theme.json

# Validate Settings.json in repo
node quickshell/.config/quickshell/Tools/validate-settings.mjs \
  --settings quickshell/.config/quickshell/Settings.json \
  --schema quickshell/.config/quickshell/Docs/SettingsSchema.json

# Validate Theme.json in repo with constraints
node quickshell/.config/quickshell/Tools/validate-theme.mjs \
  --theme quickshell/.config/quickshell/Theme.json \
  --schema quickshell/.config/quickshell/Docs/ThemeHierarchical.json \
  --constraints quickshell/.config/quickshell/Docs/ThemeConstraints.json \
  --strict

node quickshell/.config/quickshell/Tools/lint-settings.mjs
