fmt:
    nix fmt

check:
    nix flake check -L

lint:
    set -eu
    statix check -- .
    deadnix --fail .
    if git ls-files -- '*.py' >/dev/null 2>&1; then \
      ruff check -- .; \
      black --check --line-length 100 --extend-exclude '(secrets/crypted|modules/user/gui/kitty/conf/tab_bar.py)' .; \
    fi
    files=$(git ls-files '*.sh' '*.bash' || true); \
    if [ -n "$files" ]; then \
      shellcheck -S style -x $files; \
    fi

hm-neg:
    home-manager switch --flake .#neg

hm-lite:
    home-manager switch --flake .#neg-lite

hooks-enable:
    git config core.hooksPath nix/.config/home-manager/.githooks

clean-caches:
    set -eu
    repo=$(git rev-parse --show-toplevel)
    find "$repo" -type f -name '*.zwc' -delete || true
    find "$repo" -type d -name '__pycache__' -prune -exec rm -rf {} + || true
    find "$repo" -type f -name '*.pyc' -delete || true
    rm -rf "$repo/nix/.config/home-manager/.cache" || true
    : "${XDG_CACHE_HOME:=$HOME/.cache}"
    : "${XDG_STATE_HOME:=$HOME/.local/state}"
    rm -rf "$XDG_CACHE_HOME/zsh" || true
    rm -rf "$XDG_CACHE_HOME/nu" "$XDG_CACHE_HOME/nushell" || true
    rm -f "$XDG_STATE_HOME/nushell/history.sqlite3"* || true
