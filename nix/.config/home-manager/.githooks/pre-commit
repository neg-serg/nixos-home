#!/usr/bin/env bash
set -euo pipefail

if [ "${SKIP_NIX_FMT:-0}" = "1" ]; then
  exit 0
fi

if ! command -v nix >/dev/null 2>&1; then
  echo "[pre-commit] nix not found in PATH; skipping nix fmt" >&2
  exit 0
fi

echo "[pre-commit] nix fmt (alejandra)" >&2
nix fmt >/dev/null

changed_nix=$(git diff --name-only -- '*.nix')
if [ -n "${changed_nix}" ]; then
  # shellcheck disable=SC2086
  git add ${changed_nix}
fi

exit 0
