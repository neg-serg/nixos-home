#!/bin/sh
# mp: play with mpv and print media info for inputs concurrently
# Usage: mp FILES...
#   Spawns vid-info for provided files/dirs and plays them via mpv.


IFS=' \t\n'
if [ "${1:-}" = "-h" ] || [ "${1:-}" = "--help" ]; then
  sed -n '2,4p' "$0" | sed 's/^# \{0,1\}//'; exit 0
fi

main() {
    # Info for directories
    for arg in "$@"; do
        if [ -d "$arg" ]; then
            find -- "$arg" -maxdepth 1 -type f -print0 | xargs -0 -n10 -P 10 vid-info &
        fi
    done
    # Info for files
    {
        for arg in "$@"; do
            [ -f "$arg" ] && printf '%s\0' "$arg"
        done | xargs -0 -n10 -P 10 ~/.local/bin/vid-info
    } &
    mkdir -p -- "$HOME/tmp"
    mpv --quiet -- "$@" > "$HOME/tmp/mpv.log" 2>&1
}

main "$@"

